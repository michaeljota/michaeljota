<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Finally! We Have a Finally (But We Already Had One) | michaeljota</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="An explanation about the finally method in Promises.">
<meta name="keywords" content="javascript,es2018">
<meta property="og:type" content="article">
<meta property="og:title" content="Finally! We Have a Finally (But We Already Had One)">
<meta property="og:url" content="http://michaeljota.github.com/finally-we-have-a-finally-but-we-already-had-one/index.html">
<meta property="og:site_name" content="michaeljota">
<meta property="og:description" content="An explanation about the finally method in Promises.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://78.media.tumblr.com/625dcb0918e78fdf75030507f8085039/tumblr_n05mepfYgB1tq4of6o1_500.gif">
<meta property="og:image" content="https://media.giphy.com/media/CDJo4EgHwbaPS/giphy.gif">
<meta property="og:updated_time" content="2018-02-01T23:11:42.456Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Finally! We Have a Finally (But We Already Had One)">
<meta name="twitter:description" content="An explanation about the finally method in Promises.">
<meta name="twitter:image" content="https://78.media.tumblr.com/625dcb0918e78fdf75030507f8085039/tumblr_n05mepfYgB1tq4of6o1_500.gif">
  
    <link rel="alternate" href="/atom.xml" title="michaeljota" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">michaeljota</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A world about my thoughs</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://michaeljota.github.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-finally-we-have-a-finally-but-we-already-had-one" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/finally-we-have-a-finally-but-we-already-had-one/" class="article-date">
  <time datetime="2018-01-06T16:00:00.000Z" itemprop="datePublished">2018-01-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Finally! We Have a Finally (But We Already Had One)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://78.media.tumblr.com/625dcb0918e78fdf75030507f8085039/tumblr_n05mepfYgB1tq4of6o1_500.gif" alt="Promise"></p>
<p>I like to dig around the new features that are coming to JS, even when most of the time we need to transpile them down, you should know that you can, and should, deploy to production <a href="https://philipwalton.com/articles/deploying-es2015-code-in-production-today" target="_blank" rel="noopener">using ES2015+ syntax today</a>. In the <a href="https://github.com/tc39/proposals/blob/master/README.md" target="_blank" rel="noopener">current list of proposals in stage-3</a>, was something that catch my attention. That was the <a href="https://github.com/tc39/proposal-promise-finally" target="_blank" rel="noopener">Promise.prototype.finally</a>.</p>
<h1 id="FINALLY"><a href="#FINALLY" class="headerlink" title="FINALLY!"></a>FINALLY!</h1><p>So we now have a finally method into Promise. A finally method will be called always, and doesn’t care if the Promise was fulfilled or rejected. It will no alter the value of the resolve promise, but could reject the promise with a new reason. Currently there are several implementations in other future libraries in NPM, as in the current proposal is written. However this, soon to be standard, will allow to use the method in evergreen browsers.</p>
<h1 id="When-to-use-it"><a href="#When-to-use-it" class="headerlink" title="When to use it"></a>When to use it</h1><p>The finally statement is really common in programming, specially when dealing with external connections that must be closed even in an unsuccessful operation, such as reading external files or database operations. Such connections need to be closed, and doesn’t matter if the operation was successful or not, we just need to close the connection.</p>
<h1 id="How-to-use-it"><a href="#How-to-use-it" class="headerlink" title="How to use it"></a>How to use it</h1><p>The finally method is really straightforward, every promise will have one, and it will return a promise as well, so you could chain as usual. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">    .resolve(<span class="number">3</span>)</span><br><span class="line">    .finally(</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'FINALLY!'</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    .then(</span><br><span class="line">        value =&gt; <span class="built_in">console</span>.log(value) <span class="comment">// Output: 3</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<p>As you may notice, resolving a value in the finally, have not effects. However, you should know that, per specification, a Promise can be rejected from a finally method.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">    .resolve(<span class="number">3</span>)</span><br><span class="line">    .finally(</span><br><span class="line">        () =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'FINALLY!'</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="number">4</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    .then(</span><br><span class="line">        value =&gt; <span class="built_in">console</span>.log(value) <span class="comment">// Does not print</span></span><br><span class="line">    ).catch(</span><br><span class="line">        error =&gt; <span class="built_in">console</span>.log(error) <span class="comment">// Output: 4</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure></p>
<h1 id="How-to-use-it-today"><a href="#How-to-use-it-today" class="headerlink" title="How to use it, today"></a>How to use it, today</h1><p>Well, you could use one of the different future libraries, such <a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="noopener">Bluebird</a>, or the finally shim and use it with ES2017, that have a new syntax to deal with promises, <code>async</code>/<code>await</code>. I really love them, and they are very handy to work with promises, writing code that looks very clean. This couple makes every function, an asynchronous function, that are resolved as a regular Promise. So, you could just do finally after the declaration of the async function.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promiseA = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">promiseA.finally(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'The promise either was a success or a failure'</span>));</span><br></pre></td></tr></table></figure></p>
<p>The finally method will be called, as per the specification. But, what if we need to <code>try</code>/<code>catch</code> inside the async function (That you should). Then, we could use the <code>finally</code> statement.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> aSuperUsefulPromise = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> PromiseThatCouldThrow();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">    <span class="comment">// We don't modify the promise here, just catch the error and handle it.</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">await</span> aSuperUsefulPromise()) <span class="comment">// Outputs: 4</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://media.giphy.com/media/CDJo4EgHwbaPS/giphy.gif" alt="Wait... What?"><br>Well, when dealing with <code>try</code>/<code>catch</code>/<code>finally</code> you CAN modify the value of a resolved promise. And this is really important to notice and understand, as you may expect a different result. So, you should never return inside a finally statement. It maybe weird to you, cause JS have a implicit return statement, but that return will be called after the finally statement, not before.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The <code>finally</code> method in Promises will be something, but we could accomplish more or less the same behavior using current <code>try</code>/<code>catch</code>/<code>finally</code> statements, we need to be careful though. </p>
<p>I learn a lot writing this article, and I hope that you could understand a little more about the new <code>finally</code> method. Thanks you for reading, and as usual, if I made a mistake, please, guide me in the comments below, I will deeply appreciate it. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://michaeljota.github.com/finally-we-have-a-finally-but-we-already-had-one/" data-id="cjd5v7wby0006cctz64qd1gsk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es2018/">es2018</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/integration-an-angular-cli-application-with-electron-the-seed/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Integration an Angular-CLI Application With Electron - the Seed
        
      </div>
    </a>
  
  
    <a href="/pages-a-component-convention-for-angular-s-pages/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Pages: A Component Convention for Angular&#39;s Pages</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/components/">components</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/electron/">electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es2018/">es2018</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webcomponents/">webcomponents</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/widgets/">widgets</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/angular/" style="font-size: 20px;">angular</a> <a href="/tags/components/" style="font-size: 17.5px;">components</a> <a href="/tags/electron/" style="font-size: 15px;">electron</a> <a href="/tags/es2018/" style="font-size: 10px;">es2018</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/typescript/" style="font-size: 12.5px;">typescript</a> <a href="/tags/webcomponents/" style="font-size: 10px;">webcomponents</a> <a href="/tags/widgets/" style="font-size: 15px;">widgets</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/integration-an-angular-cli-application-with-electron-the-ipc/">Integration an Angular-CLI Application With Electron - the IPC</a>
          </li>
        
          <li>
            <a href="/electron-with-typescript-using-ts-node/">Electron With Typescript Using Ts-Node</a>
          </li>
        
          <li>
            <a href="/integration-an-angular-cli-application-with-electron-the-seed/">Integration an Angular-CLI Application With Electron - the Seed</a>
          </li>
        
          <li>
            <a href="/finally-we-have-a-finally-but-we-already-had-one/">Finally! We Have a Finally (But We Already Had One)</a>
          </li>
        
          <li>
            <a href="/pages-a-component-convention-for-angular-s-pages/">Pages: A Component Convention for Angular&#39;s Pages</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Michael De Abreu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>